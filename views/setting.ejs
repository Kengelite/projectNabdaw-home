<!DOCTYPE html>
<html lang="th">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ระบบจัดการผู้ใช้งาน</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-4Q6Gf2aSP4eDXB8Miphtr37CMZZQ5oXLH2yaXMJ2w8e2ZtHTl7GptT4jmndRuHDT" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-j1CDi7MgGQ12Z7Qab0qlWQ/Qqz24Gc6BM0thvEMVjHnfYGF0rmFCozFSxQBxwHKO"
        crossorigin="anonymous"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Thai:wght@100..900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">

    <!-- chart JS -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- jQuery + DataTables JS -->
    <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/dataTables.bootstrap5.min.js"></script>
    <link rel="stylesheet" href="../css/table.css">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>


</head>

<body>
    <div class="container-fluid p-0">
        <!-- Top Bar -->
        <%- include('header') %>

            <div class="row">
                <!-- Main Content -->
                <%- include('menu') %>
                    <div class="col-12 col-md-9 col-lg-10 mt-4 px-3">
                        <!-- Statistics Cards -->

                        <!-- Users Table -->
                        <div class="">
                            <h4>ตั้งค่าข้อมูล</h4>
                            <div class="">
                                <!-- ข้อมูลหอพัก -->
                                <div class="card mb-4">
                                    <div class="card-header d-flex justify-content-between align-items-center">
                                        <h5 class="mb-0">ข้อมูลหอพัก</h5>
                                        <button class="btn btn-sm btn-outline-warning" data-bs-toggle="modal"
                                            data-bs-target="#editDormModal">แก้ไข</button>
                                    </div>
                                    <div class="card-body">
                                        <div class="row mb-3 align-items-center">
                                            <div class="col-md-2 text-center">
                                                <img src="https://picsum.photos/200/300?grayscale"
                                                    class="img-fluid rounded"
                                                    style="max-height: 150px; object-fit: contain;" alt="โลโก้หอพัก">
                                            </div>
                                            <div class="col-md-10">
                                                <p><strong>ชื่อหอพัก:</strong> หอพักวิทยาลัย</p>
                                                <p><strong>ที่อยู่:</strong> 123 ถนนสุขใจ แขวงบางรัก เขตบางรัก กรุงเทพฯ
                                                    10500</p>
                                                <p><strong>เบอร์ติดต่อ:</strong> 02-123-4567</p>
                                                <p><strong>เลขประจำตัวผู้เสียภาษี:</strong> 0123456789012</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- ตั้งค่าการออกบิล -->
                                <div class="card mb-4">
                                    <div class="card-header d-flex justify-content-between align-items-center">
                                        <h5 class="mb-0">ตั้งค่าการออกบิล</h5>
                                        <button class="btn btn-sm btn-outline-warning" data-bs-toggle="modal"
                                            data-bs-target="#editBillModal">แก้ไข</button>
                                    </div>
                                    <div class="card-body">
                                        <p><strong>วันที่ออกบิลประจำเดือน:</strong> วันที่ 1</p>
                                        <p><strong>กำหนดชำระ:</strong> ภายใน 5 วันหลังจากออกบิล</p>
                                        <p><strong>ค่าปรับล่าช้า:</strong> 20 บาท/วัน</p>
                                    </div>
                                </div>

                                <!-- อัตราค่าน้ำ-ค่าไฟ -->
                                <div class="card mb-4">
                                    <div class="card-header d-flex justify-content-between align-items-center">
                                        <h5 class="mb-0">อัตราค่าน้ำ - ค่าไฟ</h5>
                                        <button class="btn btn-sm btn-outline-warning" data-bs-toggle="modal"
                                            data-bs-target="#editRateModal">แก้ไข</button>
                                    </div>
                                    <div class="card-body">
                                        <p><strong>ค่าน้ำ:</strong> 20 บาท/หน่วย</p>
                                        <p><strong>ค่าไฟ:</strong> 7 บาท/หน่วย</p>
                                    </div>
                                </div>

                                <!-- บัญชีธนาคาร -->
                                <div class="card mb-4">
                                    <div class="card-header d-flex justify-content-between align-items-center">
                                        <h5 class="mb-0">บัญชีสำหรับชำระเงิน</h5>
                                        <button class="btn btn-sm btn-outline-warning" data-bs-toggle="modal"
                                            data-bs-target="#editBankModal">
                                            แก้ไข
                                        </button>
                                    </div>
                                    <div class="card-body">
                                        <p><strong>ธนาคาร:</strong> ไทยพาณิชย์</p>
                                        <p><strong>เลขที่บัญชี:</strong> 123-456-7890</p>
                                        <p><strong>ชื่อบัญชี:</strong> หอพักวิทยาลัย</p>

                                        <!-- แสดงรูปบัญชี/QR Code -->
                                        <div class="text-center mt-3">
                                            <img src="https://www.octopus.co.th/cdn/shop/files/14771108_website_14.png?v=1746499536"
                                                alt="บัญชีสำหรับชำระเงิน" class="img-fluid border rounded"
                                                style="max-height: 200px;">
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Modal แก้ไขข้อมูลหอพัก -->
                            <div class="modal fade" id="editDormModal" tabindex="-1">
                                <div class="modal-dialog">
                                    <div class="modal-content">
                                        <div class="modal-header">
                                            <h5 class="modal-title">แก้ไขข้อมูลหอพัก</h5>
                                        </div>
                                        <div class="modal-body">
                                            <input type="text" class="form-control mb-2" placeholder="ชื่อหอพัก">
                                            <textarea class="form-control mb-2" placeholder="ที่อยู่"></textarea>
                                            <input type="text" class="form-control mb-2" placeholder="เบอร์ติดต่อ">
                                            <input type="text" class="form-control" placeholder="เลขผู้เสียภาษี">
                                        </div>
                                        <div class="modal-footer">
                                            <button class="btn btn-secondary" data-bs-dismiss="modal">ยกเลิก</button>
                                            <button class="btn btn-primary">บันทึก</button>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Modal ตั้งค่าบิล -->
                            <div class="modal fade" id="editBillModal" tabindex="-1">
                                <div class="modal-dialog">
                                    <div class="modal-content">
                                        <div class="modal-header">
                                            <h5 class="modal-title">แก้ไขการตั้งค่าบิล</h5>
                                        </div>
                                        <div class="modal-body">
                                            <input type="number" class="form-control mb-2"
                                                placeholder="วันที่ออกบิล (1-31)">
                                            <input type="number" class="form-control mb-2"
                                                placeholder="จำนวนวันในการชำระ">
                                            <input type="number" class="form-control"
                                                placeholder="ค่าปรับล่าช้า (บาท/วัน)">
                                        </div>
                                        <div class="modal-footer">
                                            <button class="btn btn-secondary" data-bs-dismiss="modal">ยกเลิก</button>
                                            <button class="btn btn-primary">บันทึก</button>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Modal แก้ไขอัตราค่าน้ำ-ไฟ -->
                            <div class="modal fade" id="editRateModal" tabindex="-1">
                                <div class="modal-dialog">
                                    <div class="modal-content">
                                        <div class="modal-header">
                                            <h5 class="modal-title">แก้ไขอัตราค่าน้ำ - ค่าไฟ</h5>
                                        </div>
                                        <div class="modal-body">
                                            <input type="number" class="form-control mb-2"
                                                placeholder="ค่าน้ำ (บาท/หน่วย)">
                                            <input type="number" class="form-control" placeholder="ค่าไฟ (บาท/หน่วย)">
                                        </div>
                                        <div class="modal-footer">
                                            <button class="btn btn-secondary" data-bs-dismiss="modal">ยกเลิก</button>
                                            <button class="btn btn-primary">บันทึก</button>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Modal แก้ไขบัญชีธนาคาร -->
                            <div class="modal fade" id="editBankModal" tabindex="-1">
                                <div class="modal-dialog">
                                    <div class="modal-content">
                                        <div class="modal-header">
                                            <h5 class="modal-title">แก้ไขข้อมูลบัญชีธนาคาร</h5>
                                        </div>
                                        <div class="modal-body">
                                            <input type="text" class="form-control mb-2" placeholder="ชื่อธนาคาร">
                                            <input type="text" class="form-control mb-2" placeholder="เลขที่บัญชี">
                                            <input type="text" class="form-control mb-3" placeholder="ชื่อบัญชี">

                                            <label class="form-label fw-bold">รูปภาพบัญชี/QR Code</label>
                                            <input type="file" class="form-control mb-2" id="bankImageInput"
                                                accept="image/*">
                                            <div class="text-center mt-3">
                                                <img id="bankImagePreview"
                                                    src="https://www.octopus.co.th/cdn/shop/files/14771108_website_14.png?v=1746499536"
                                                    alt="Preview" class="img-fluid mt-2 border rounded"
                                                    style="max-height: 200px;">
                                            </div>
                                        </div>
                                        <div class="modal-footer">
                                            <button class="btn btn-secondary" data-bs-dismiss="modal">ยกเลิก</button>
                                            <button class="btn btn-primary">บันทึก</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
            </div>

            <!-- Add User Modal -->
            <div class="modal fade" id="addModal" tabindex="-1" aria-labelledby="addModalLabel" aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="addModalLabel">
                                <!-- <i class="bi bi-person-plus me-2"></i> -->
                                เพิ่มผู้ใช้ใหม่
                            </h5>
                            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                        </div>
                        <div class="modal-body">
                            <form id="addUserForm">
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label class="form-label">ชื่อ <span class="text-danger">*</span></label>
                                        <input type="text" class="form-control" id="addFirstName" required>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label class="form-label">นามสกุล <span class="text-danger">*</span></label>
                                        <input type="text" class="form-control" id="addLastName" required>
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">อีเมล <span class="text-danger">*</span></label>
                                    <input type="email" class="form-control" id="addEmail" required>
                                </div>
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label class="form-label">บทบาท <span class="text-danger">*</span></label>
                                        <select class="form-select" id="addRole" required>
                                            <option value="">เลือกบทบาท</option>
                                            <option value="Admin">Admin</option>
                                            <option value="User">User</option>
                                            <option value="Guest">Guest</option>
                                        </select>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label class="form-label">สถานะ</label>
                                        <select class="form-select" id="addStatus">
                                            <option value="active">ใช้งานได้</option>
                                            <option value="inactive">ระงับการใช้งาน</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">รหัสผ่าน <span class="text-danger">*</span></label>
                                    <input type="password" class="form-control" id="addPassword" required>
                                </div>
                            </form>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ยกเลิก</button>
                            <button type="button" class="btn btn-primary" onclick="addUser()">
                                <i class="bi bi-check-lg me-2"></i>บันทึก
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Edit User Modal -->
            <div class="modal fade" id="editModal" tabindex="-1" aria-labelledby="editModalLabel" aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="editModalLabel">
                                <!-- <i class="bi bi-pencil me-2"></i> -->
                                แก้ไขข้อมูลผู้ใช้
                            </h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                        </div>
                        <div class="modal-body">
                            <form id="editUserForm">
                                <input type="hidden" id="editUserId">
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label class="form-label">ชื่อ <span class="text-danger">*</span></label>
                                        <input type="text" class="form-control" id="editFirstName" required>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label class="form-label">นามสกุล <span class="text-danger">*</span></label>
                                        <input type="text" class="form-control" id="editLastName" required>
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">อีเมล <span class="text-danger">*</span></label>
                                    <input type="email" class="form-control" id="editEmail" required>
                                </div>
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label class="form-label">บทบาท <span class="text-danger">*</span></label>
                                        <select class="form-select" id="editRole" required>
                                            <option value="Admin">Admin</option>
                                            <option value="User">User</option>
                                            <option value="Guest">Guest</option>
                                        </select>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label class="form-label">สถานะ</label>
                                        <select class="form-select" id="editStatus">
                                            <option value="active">ใช้งานได้</option>
                                            <option value="inactive">ระงับการใช้งาน</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">รหัสผ่านใหม่ (เว้นว่างไว้หากไม่ต้องการเปลี่ยน)</label>
                                    <input type="password" class="form-control" id="editPassword">
                                </div>
                            </form>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ยกเลิก</button>
                            <button type="button" class="btn btn-warning" onclick="updateUser()">
                                <i class="bi bi-check-lg me-2"></i>อัปเดต
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- View User Modal -->
            <div class="modal fade" id="viewModal" tabindex="-1" aria-labelledby="viewModalLabel" aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered">
                    <div class="modal-content">
                        <div class="modal-header ">
                            <h5 class="modal-title" id="viewModalLabel">
                                <!-- <i class="bi bi-eye me-2"></i> -->
                                ข้อมูลผู้ใช้
                            </h5>
                            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                        </div>
                        <div class="modal-body">
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label class="form-label fw-bold" for="viewUserId">ID:</label>
                                    <input type="text" id="viewUserId" class="form-control" readonly>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label class="form-label fw-bold" for="viewRole">บทบาท:</label>
                                    <input type="text" id="viewRole" class="form-control" readonly>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label class="form-label fw-bold" for="viewFirstName">ชื่อ:</label>
                                    <input type="text" id="viewFirstName" class="form-control" readonly>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label class="form-label fw-bold" for="viewLastName">นามสกุล:</label>
                                    <input type="text" id="viewLastName" class="form-control" readonly>
                                </div>
                            </div>
                            <div class="mb-3">
                                <label class="form-label fw-bold" for="viewEmail">อีเมล:</label>
                                <input type="text" id="viewEmail" class="form-control" readonly>
                            </div>
                            <div class="mb-3">
                                <label class="form-label fw-bold" for="viewStatus">สถานะ:</label>
                                <input type="text" id="viewStatus" class="form-control" readonly>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ปิด</button>
                        </div>
                    </div>
                </div>
            </div>
    </div>

    <script>
        // Initialize DataTable
        $(document).ready(function () {
            $('#myDataTable').DataTable({
                language: {
                    search: "ค้นหา:",
                    lengthMenu: "แสดง _MENU_ รายการ",
                    info: "แสดง _START_ ถึง _END_ จาก _TOTAL_ รายการ",
                    infoEmpty: "แสดง 0 ถึง 0 จาก 0 รายการ",
                    infoFiltered: "(กรองจาก _MAX_ รายการทั้งหมด)",
                    paginate: {
                        first: "หน้าแรก",
                        last: "หน้าสุดท้าย",
                        next: "ถัดไป",
                        previous: "ย้อนกลับ"
                    },
                    emptyTable: "ไม่มีข้อมูลในตาราง",
                    zeroRecords: "ไม่พบข้อมูลที่ค้นหา"
                },
                pageLength: 10,
                responsive: true
            });
        });

        // Add User Function
        function addUser() {
            const firstName = document.getElementById('addFirstName').value;
            const lastName = document.getElementById('addLastName').value;
            const email = document.getElementById('addEmail').value;
            const role = document.getElementById('addRole').value;
            const status = document.getElementById('addStatus').value;
            const password = document.getElementById('addPassword').value;

            if (!firstName || !lastName || !email || !role || !password) {
                Swal.fire('ข้อผิดพลาด!', 'กรุณากรอกข้อมูลให้ครบถ้วน', 'error');
                return;
            }

            // TODO: ส่งข้อมูลไปยัง API
            Swal.fire('สำเร็จ!', 'เพิ่มผู้ใช้ใหม่เรียบร้อยแล้ว', 'success').then(() => {
                // ปิด modal และรีเซ็ตฟอร์ม
                const modal = bootstrap.Modal.getInstance(document.getElementById('addModal'));
                modal.hide();
                document.getElementById('addUserForm').reset();
                // TODO: รีเฟรชตาราง
            });
        }

        // Edit User Function
        function editUser(id, firstName, lastName, email, role) {
            document.getElementById('editUserId').value = id;
            document.getElementById('editFirstName').value = firstName;
            document.getElementById('editLastName').value = lastName;
            document.getElementById('editEmail').value = email;
            document.getElementById('editRole').value = role;
        }

        function updateUser() {
            const id = document.getElementById('editUserId').value;
            const firstName = document.getElementById('editFirstName').value;
            const lastName = document.getElementById('editLastName').value;
            const email = document.getElementById('editEmail').value;
            const role = document.getElementById('editRole').value;
            const status = document.getElementById('editStatus').value;

            if (!firstName || !lastName || !email || !role) {
                Swal.fire('ข้อผิดพลาด!', 'กรุณากรอกข้อมูลให้ครบถ้วน', 'error');
                return;
            }

            // TODO: ส่งข้อมูลไปยัง API
            Swal.fire('สำเร็จ!', 'อัปเดตข้อมูลผู้ใช้เรียบร้อยแล้ว', 'success').then(() => {
                const modal = bootstrap.Modal.getInstance(document.getElementById('editModal'));
                modal.hide();
                // TODO: รีเฟรชตาราง
            });
        }

        // View User Function
        function viewUser(id, firstName, lastName, email, role) {
            document.getElementById('viewUserId').value = id;
            document.getElementById('viewFirstName').value = firstName;
            document.getElementById('viewLastName').value = lastName;
            document.getElementById('viewEmail').value = email;
            document.getElementById('viewRole').value = role;
            document.getElementById('viewStatus').value = 'ใช้งานได้'; // TODO: ดึงจากข้อมูลจริง
        }

        // Delete Confirmation
        function confirmDelete(userName) {
            Swal.fire({
                title: 'คุณแน่ใจหรือไม่?',
                text: `คุณต้องการลบผู้ใช้ ${userName} หรือไม่?`,
                icon: 'warning',
                showCancelButton: true,
                confirmButtonText: 'ใช่, ลบเลย!',
                cancelButtonText: 'ยกเลิก',
                confirmButtonColor: '#d33',
                cancelButtonColor: '#6c757d'
            }).then((result) => {
                if (result.isConfirmed) {
                    // TODO: ดำเนินการลบผู้ใช้
                    Swal.fire('ลบแล้ว!', 'ลบผู้ใช้เรียบร้อยแล้ว', 'success');
                    // TODO: รีเฟรชตาราง
                }
            });
        }
    </script>
</body>

</html>